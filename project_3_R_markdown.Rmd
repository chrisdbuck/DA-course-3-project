# Advanced Analytics to Improve Sales at Turtle Games

## Load Packages

```{r}
# Load necessary packages
suppressMessages(library(dplyr))
library(ggplot2)
suppressMessages(library(corrplot))
library(moments)
```

## Functions

### Descriptive Statistics

This function returns measures of central tendency, variability, shape, and normality for the specified variable.

```{r}
descriptive_stats <- function(x){
  # Calculate mean, median, and mode
  mean_score <- mean(x)
  median_score <- median(x)
  mode_score <- as.numeric(names(sort(table(x), decreasing = TRUE)[1]))
  
  # Calculate Range
  range_satisfaction <- range(x)
  
  # Calculate Difference between highest and lowest values
  difference_high_low <- diff(range_satisfaction)
  
  # Calculate Interquartile Range (IQR)
  iqr_satisfaction <- IQR(x)
  
  # Calculate Variance
  variance_satisfaction <- var(x)
  
  # Calculate Standard Deviation
  std_deviation_satisfaction <- sd(x)
  
  # Skewness and Kurtosis
  skewness_score = skewness(x)
  kurtosis_score = kurtosis(x)
  
  # Shapiro-Wilk test for normality
  shapiro_score = shapiro.test(x)
  shapiro_p <- shapiro_score$p.value
  
  # Print the results
  cat("MEASURES OF CENTRAL TENDENCY", "\n")
  cat("Mean:", mean_score, "\n")
  cat("Median:", median_score, "\n")
  cat("Mode:", mode_score, "\n")
  cat("\n")
  cat("MEASURES OF VARIABILITY", "\n")
  cat("Range:", range_satisfaction, "\n")
  cat("Difference:", difference_high_low, "\n")
  cat("IQR:", iqr_satisfaction, "\n")
  cat("Variance:", variance_satisfaction, "\n")
  cat("Standard Deviation:", std_deviation_satisfaction, "\n")
  cat("\n")
  cat("MEASURES OF SHAPE", "\n")
  cat("Skewness:", skewness_score, "\n")
  cat("Kurtosis:", kurtosis_score, "\n")
  cat("\n")
  cat("MEASURES OF NORMALITY", "\n")
  cat("Shapiro-Wilk p-value:", formatC(shapiro_p, format = "e", digits = 2))
}
```

## Data Import

```{r}
# Import turtle_rviews.csv into dataframe
df <- read.csv("turtle_reviews.csv")
```

## Data Viewing and Validation

```{r}
# View head of dataframe
head(df)
```

```{r}
# View the structure of the dataframe
str(df)
```

**"remuneration..." and "spending_score..." column names should be changed.**

```{r}
# Search for missing values
sum(is.na(df))
```

**There are no missing values.**

```{r}
# Check for unique values
sapply(df, function(x) n_distinct(x))
```

**Two columns ("language" and "platform") have only one unique value so they can be removed.**

```{r}
# Check for duplicate rows
nrow(df[duplicated(df), ])
```

**There are no duplicate rows in the dataframe.**

```{r}
#View summary of dataframe
summary(df)
```

**The range of age values, remuneration (income) values, and spending score values make sense.**

## Data Cleaning and Transformation

```{r}
# Create a new dataframe with fewer, renamed, and changed-type columns
clean_df <- data.frame(
  gender = df$gender,
  age = df$age,
  income = df$remuneration..k..,
  spending_score = df$spending_score..1.100.,
  loyalty_points = df$loyalty_points,
  education = df$education,
  product = as.character(df$product),
  review = df$review,
  summary = df$summary
)

head(clean_df)
```

**Removed "language" and "platform" columns. The "renumeration..." column is now "income" and the extra characters in the "spending_score..." column have been removed. Changed "product" column from numeric type to character type.**

## Data Exploration

### Gender

```{r}
# Frequency table for the 'gender' column
gender_freq <- table(clean_df$gender)
print(gender_freq)
```

**There are slightly more female customers than male customers.**

```{r}
# Create a bar plot for average 'loyalty_points' by 'gender'
clean_df %>%
  group_by(gender) %>% 
  summarize(m = median(loyalty_points)) %>% 
  ggplot(aes(x = gender, y = m)) +
    geom_bar(stat = "identity", fill = "darkolivegreen", color = "black") +
    labs(title = "Median Loyalty Points by Gender", x = "Gender", y = "Loyalty Points") +
    geom_text(aes(label = m), nudge_y = 50) +
    theme_minimal()
```

**On average, female and male customers accumulate similar amounts of loyalty points**

### Education

```{r}
# Frequency table for the 'education' column
ed_freq <- table(clean_df$education)
print(ed_freq)
```

**The overwhelming majority of customers have a university education.**

```{r}
# Create a bar plot for average 'loyalty_points' by 'education'
clean_df %>%
  group_by(education) %>% 
  summarize(m = median(loyalty_points)) %>% 
  ggplot(aes(x = education, y = m)) +
    geom_bar(stat = "identity", fill = "darkolivegreen", color = "black") +
    labs(title = "Median Loyalty Points by Education", x = "Education", y = "Loyalty Points") +
    geom_text(aes(label = m), nudge_y = 50) +
    theme_minimal()
```

**On average, customers with a basic education accumulate more loyalty points than customers with higher levels of education.**

### Age

```{r}
# Create a histogram for 'age'
plot <- ggplot(data = clean_df, aes(x = age)) +
  geom_histogram(bins = 10, fill = "darkolivegreen", color = "black") +
  labs(title = "Distribution of Customer Ages", x = "Age", y = "Frequency") +
  theme_minimal()

plot
```

**The historgram is right skewed, which means that the majority of customers tend to be younger (17-40 years old).**

```{r}
# Create a box plot for 'age'
ggplot(data = clean_df, aes(y = age)) +
  geom_boxplot(fill = "darkolivegreen", color = "black") +
  labs(title = "Box Plot of Customer Age", y = "Age", x = "") +
  theme_minimal()
```

**There are no age outliers.**

```{r}
# Create a scatter plot for 'age' vs 'loyalty_points'
ggplot(data = clean_df, aes(x = age, y = loyalty_points)) +
  geom_point(color = "darkolivegreen") +
  labs(title = "Customer Age vs. Loyalty Points", x = "Customer Age", y = "Loyalty Points") +
  theme_minimal()
```

**There's an interesting horizontal gap in the plot around 2000 loyalty points that gradually increases with age until about the age of 50. There's not much of a pattern below the gap but above it there appears to be a very slight positive linear relationship between age and loyalty points.**

```{r}
# Create a trend line for 'age' vs 'loyalty_points'
ggplot(data = clean_df, aes(x = age, y = loyalty_points)) +
  geom_point(color = "darkolivegreen") +
  geom_smooth(method=lm) +
  labs(title = "Customer Age vs. Loyalty Points", x = "Customer Age", y = "Loyalty Points") +
  theme_minimal()
```

**The trend line for the scatter plot as a whole is nearly horizontal, which suggests there is very little correlation between age and loyalty points.**

### Income

```{r}
# Create a histogram for 'income'
plot <- ggplot(data = clean_df, aes(x = income)) +
  geom_histogram(bins = 10, fill = "darkolivegreen", color = "black") +
  labs(title = "Distribution of Customer Incomes", x = "Income (k£)", y = "Frequency") +
  theme_minimal()

plot
```

**The histogram is right skewed, which means that most customers tend to have incomes under £70k.**

```{r}
# Create a box plot for 'income'
ggplot(data = clean_df, aes(y = income)) +
  geom_boxplot(fill = "darkolivegreen", color = "black") +
  labs(title = "Box Plot of Customer Income", y = "Income (k£)", x = "") +
  theme_minimal()
```

**There are no income outliers.**

```{r}
# Create a trend line for 'income' vs 'loyalty_points'
ggplot(data = clean_df, aes(x = income, y = loyalty_points)) +
  geom_point(color = "darkolivegreen") +
  geom_smooth(method=lm) +
  labs(title = "Customer Income vs. Loyalty Points", x = "Income (k£)", y = "Loyalty Points") +
  theme_minimal()
```

**There is a positive linear relationship between income and loyalty points, especially for incomes below £60k. There is a wider range of loyalty point values for incomes above £60k (the residuals get longer as income increases beyond £60k).**

### Spending Score

```{r}
# Create a histogram for 'spending_score'
plot <- ggplot(data = clean_df, aes(x = spending_score)) +
  geom_histogram(bins = 8, fill = "darkolivegreen", color = "black") +
  labs(title = "Distribution of Customer Spending Scores", x = "Spending Score", y = "Frequency") +
  theme_minimal()

plot
```

**This histogram has a fairly normal distribution centred around 50 which is not surprising because this is a score assigned to customers by Turtle Games.**

```{r}
# Create a box plot for 'spending_score'
ggplot(data = clean_df, aes(y = spending_score)) +
  geom_boxplot(fill = "darkolivegreen", color = "black") +
  labs(title = "Box Plot of Customer Spending Score", y = "Spending Score", x = "") +
  theme_minimal()
```

**There are no spending score outliers**

```{r}
# Create a trend line for 'spending_score' vs 'loyalty_points'
ggplot(data = clean_df, aes(x = spending_score, y = loyalty_points)) +
  geom_point(color = "darkolivegreen", alpha = .75) +
  geom_smooth(method=lm) +
  labs(title = "Customer Spending Score vs. Loyalty Points", x = "Spending Score", y = "Loyalty Points") +
  theme_minimal()
```

**There is a positive linear relationship between spending score and loyalty points, especially for spending scores below £60k. There is a wider range of loyalty point values for spending scores above 60 (the residuals tend to get longer as spending score increases beyond 60).**

### Loyalty Points

```{r}
# Create a histogram for 'loyalty_points'
plot <- ggplot(data = clean_df, aes(x = loyalty_points)) +
  geom_histogram(bins = 8, fill = "darkolivegreen", color = "black") +
  labs(title = "Distribution of Customer Loyalty Points", x = "Loyalty Points", y = "Frequency") +
  theme_minimal()

plot
```

**The historgram is right skewed, which means that the majority of customers have less than approximately 2,500 loyalty points.**

```{r}
# Create a box plot for 'loyalty_points'
ggplot(data = clean_df, aes(y = loyalty_points)) +
  geom_boxplot(fill = "darkolivegreen", color = "black") +
  labs(title = "Box Plot of Customer Loyalty Points", y = "Loyalty Points", x = "") +
  theme_minimal()
```

**The loyalty points box plot has several outliers on the upper end because a number of customers have earned a lot of loyalty points. There is no reason to remove these values from the dataset.**

### Product

```{r}
# Create dataframe grouped by product number
product_df <- clean_df %>%
  group_by(product) %>% 
  summarize(avg_lp = mean(loyalty_points), product_count = n())

summary(product_df)
```

**There are 200 different product numbers and there is an average of 10 records for each product, with each product number having at least 8 records and no more than 13 records. The highest average loyalty points for a product number is 3,340.8 whereas the lowest average loyalty points for a product number is 556.5**

```{r}
arrange(product_df, desc(avg_lp))
```

```{r}
# Filter clean_df by product number
filter(clean_df, product == "9080")
```

**The reviews for this product number seem to be discussing different products so I have concluded that each unique product number does not refer a unique product. This precludes me from conducting any product-specific analysis, such as whether there are specific products that high reviews with especially high or low sentiment scores.**

## Correlation Analysis

```{r}
# Create new dataframe with numeric columns
numeric_df <- clean_df %>%
  select_if(is.numeric)

head(numeric_df)
```

**The product column is not included because I transformed it to a character/string type**

```{r}
# Calculate the correlation matrix
correlation_matrix <- cor(numeric_df, use = "complete.obs")

# View the correlation matrix
correlation_matrix
```

**Both spending score and income have a strong correlation with loyalty points in comparison to age. Spending score has a slightly higher correlation coefficient than income. This is not surprising because Turtle Games has its own formulas for assigning spending scores and awarding loyalty points to its customers and one of the main objectives of loyalty programmes is to incentivise higher levels of spending.**

```{r}
# Create the correlation plot
corrplot(correlation_matrix, method = "circle")
```

```{r}
# Pair plots to visualize relationships
pairs(clean_df[, c('loyalty_points', 'age', 'income', 'spending_score')])
```

## Descriptive Statistics for Loyalty Points Data

```{r}
# Create a histogram for 'loyalty_points'
plot <- ggplot(data = clean_df, aes(x = loyalty_points)) +
  geom_histogram(bins = 20, fill = "darkolivegreen", color = "black") +
  labs(title = "Distribution of Customer Loyalty Points", x = "Loyalty Points", y = "Frequency") +
  theme_minimal()

plot
```

```{r}
descriptive_stats(clean_df$loyalty_points)
```

**A typical customer accumulates around 1578 loyalty points with a standard deviation of around 1283 points. The skewness score is greater than 1 so the data is asymmetrical and its distribution is not within the range of normality. The kurtosis value is also outside of the normal range and indicates the distribution plot has heavy tails and extreme values. The Shapiro-Wilk is close to zero so the loyalty points data is not normally distributed.**

```{r}
qqnorm(clean_df$loyalty_points)
qqline(clean_df$loyalty_points)
```

**The qq-plot also demonstrates how the loyalty points data deviates from the line of normality.**

## Data Modeling

### Simple Linear Regression

```{r}
# Create a model with only one x variable.
model1 <- lm(loyalty_points ~ spending_score,
             data=clean_df)


# View the model.
model1


# View more outputs for the model - the full regression table.
summary(model1)

```

**The R-squared value is okay but could probably be improved with a multiple linear regression.**

```{r}
# View residuals on a plot.
#get list of residuals 
res <- resid(model1)

#produce residual vs. fitted plot
plot(fitted(model1), res)

#add a horizontal line at 0 
abline(0,0)
```

**There residuals plot fans out on the right hand side, which violates the the assumption of homoscedasticity.**

```{r}
# Plot the relationship with base R graphics.
plot(clean_df$income, clean_df$loyalty_points)
coefficients(model1)

# Add line-of-best-fit.
abline(coefficients(model1))
```

**The line doesn't fit as the data points fan out around the £60k mark.**

### Multiple Linear Regression

```{r}
# Create the multiple linear regression model
model2 <- lm(loyalty_points ~ age + income + spending_score, data = clean_df)

# Summarize the model
summary(model2)
```

**This is a much better R-squared than that of the single linear regression model.**

```{r}
# Plot actual vs. predicted values with a smoothing method
ggplot(clean_df, aes(x = loyalty_points, y = predict(model2, clean_df))) +
  geom_point() +
  stat_smooth(method = "loess") +
  labs(x = 'Actual Loyalty Points', y = 'Predicted Loyalty Points') +
  ggtitle('Actual vs. Predicted Loyalty Points')
```

**This plot suggests the model is a pretty good fit.**

Predicting with new data

Example scenarios Let's say we have 2 new customers whose details are as follows Customer 1: age= 45, income = 60, spending_score = 25 Customer 2: age= 75, income = 20, spending_score = 50

```{r}
new_data <- data.frame(age = c(45, 75), income = c(60, 20), spending_score = c(25, 50))

# Predict satisfaction score for new scenarios
predictions <- predict(model2, new_data)
print(predictions)
```

```{r}
# Create the multiple linear regression model
model3 <- lm(loyalty_points ~ income + spending_score, data = clean_df)

#get list of residuals 
res <- resid(model3)

# Summarize the model
summary(model3)
```

**This is still a good model even without including age as an independent variable.**

```{r}
#produce residual vs. fitted plot
plot(fitted(model3), res)

#add a horizontal line at 0 
abline(0,0)
```

**There appears to be a pattern in the residuals plot so the assumption of homoscedasticity is not fulfilled.**

```{r}
qqnorm(res)
qqline(res)
```

**The data has a fairly normal distribution judging from this plot.**
